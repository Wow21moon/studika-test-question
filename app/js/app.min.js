const dropdown=document.getElementById("dropdown_city"),choice_city=document.getElementById("choice_city"),city_list=document.getElementById("city-list"),select_city_block=document.getElementById("select-city-block"),search_city_input=document.getElementById("search-city-input"),close_search_city=document.getElementById("close-search-city"),city_visible=document.getElementById("city-visible");let nameCityArg=[],cityData=[],sendDATA=[];function init(){headerSwiperMenu(),requestListCity(),cleanInputSearchCity()}function headerSwiperMenu(){const e=new Swiper(".swiper",{navigation:{nextEl:".swiper-button-next",prevEl:".swiper-button-prev"},slidesPerView:9,spaceBetween:30,freeMode:{enabled:!0,sticky:!0}});e.on("click",(function(){for(let t=0;t<e.slides.length;t++)e.slides[t].classList.remove("active-el"),e.slides[t].addEventListener("click",(function(){this.classList.add("active-el")}))}))}function requestListCity(){choice_city.addEventListener("click",(async function(){if(0==cityData.length){const e=await fetch("https://studika.ru/api/areas",{method:"POST",headers:{"content-type":"application/x-www-form-urlencoded"}}).then((e=>200!==e.status?Promise.reject():e.json())).catch((e=>console.log("ошибка "+e)));cityData=e,console.log("response",cityData),cityData.map((e=>{nameCityArg.push({name:e.name,id:e.id}),null!=e.cities&&e.cities.map((t=>{nameCityArg.push({name:t.name,id:t.id,state:e.name})}))})),formationListCity(nameCityArg),searchCity(nameCityArg)}dropdown.classList.toggle("header__top__city__dropdown--active")}))}function formationListCity(e,t){t&&(city_list.innerHTML=""),e.map((e=>{let t=document.createElement("div");if(t.classList.add("header__top__city__dropdown__list__item"),t.setAttribute("data-id",e.id),e.state){let i=document.createElement("span"),c=document.createElement("span");c.classList.add("header__top__city__dropdown__list__item__state"),i.textContent=e.name,c.textContent=e.state,t.append(i),t.append(c)}else t.textContent=e.name;city_list.append(t)}));selectCity(document.querySelectorAll("#city-list .header__top__city__dropdown__list__item"))}function selectCity(e){for(let t=0;t<e.length;t++)e[t].addEventListener("click",(function(){let e=document.createElement("div");e.classList.add("header__top__city__dropdown__select__item");let t=document.querySelectorAll(".header__top__city__dropdown__select__item");for(let e=0;e<t.length;e++)if(t[e].getAttribute("select-id")==this.getAttribute("data-id"))return void t[e].remove();0==this.children.length?(e.setAttribute("select-id",this.getAttribute("data-id")),e.innerHTML=`${this.textContent}<i class="fa-solid fa-xmark header__top__city__dropdown__select__item__cross"></i>`):(e.setAttribute("select-id",this.getAttribute("data-id")),e.innerHTML=`${this.children[0].textContent}<i class="fa-solid fa-xmark header__top__city__dropdown__select__item__cross"></i>`),select_city_block.append(e);let i=document.querySelectorAll(".header__top__city__dropdown__select__item .header__top__city__dropdown__select__item__cross");i.length>0&&deleteSelect(i),updateSelectDATA()}))}function deleteSelect(e){for(let t=0;t<e.length;t++)e[t].addEventListener("click",(function(){this.parentElement.remove(),updateSelectDATA()}))}function searchCity(e){e&&search_city_input.addEventListener("input",(function(){if(search_city_input.value.length>0){close_search_city.classList.add("header__top__city__dropdown__search__exit--active");let t=[];for(let i=0;i<e.length;i++)e[i].name.match(RegExp("^"+search_city_input.value.toLowerCase(),"i"))&&t.push(e[i]);formationListCity(t,!0)}else close_search_city.classList.remove("header__top__city__dropdown__search__exit--active")}))}function cleanInputSearchCity(){close_search_city.addEventListener("click",(function(){search_city_input.value=""}))}function updateSelectDATA(){}function cityVisible(){}init();